# paths/snapshots.yaml

get:
  tags:
    - Open
    - Snapshots
    - Sync
  summary: Get a list of snapshots
  description: |-
    Retrieves a list containing metadata for all snapshot sets stored on the system.
  operationId: listSnapshots
  security: []
  responses:
    '200':
      description: A list of snapshot sets.
      content:
        application/json:
          schema:
            type: array
            items:
              $ref: '../components/schemas/SnapshotSet.yaml'
    '400':
      $ref: '../components/responses/BadRequest.yaml'

post:
  tags:
    - Macaroon
    - Snapshots
  summary: Manipulate or import a snapshot
  description: |-
    Performs an action on a snapshot set, such as restoring, checking, forgetting, or importing from a data stream.
  operationId: manageSnapshots
  security:
    - macaroonAuth: []
  requestBody:
    description: The action to perform. Can be a JSON object for manipulation or a binary stream for import.
    required: true
    content:
      application/json:
        schema:
          type: object
          description: Used for snapshot manipulation actions.
          required:
            - action
            - set
          properties:
            action:
              type: string
              enum: [restore, check, forget]
            set:
              type: integer
              description: The ID of the snapshot set to operate on.
            snaps:
              type: array
              description: An array of snap names to restrict the action to.
              items:
                type: string
            users:
              type: array
              description: An array of user names to restrict the action to (for restore only).
              items:
                type: string
      application/x.snapd.snapshot:
        schema:
          type: string
          format: binary
          description: A tar archive of an exported snapshot, used for the import action.
  responses:
    '200':
      description: The response for a successful synchronous import.
      content:
        application/json:
          schema:
            type: object
            properties:
              type:
                type: string
                example: sync
              result:
                type: object
                properties:
                  set:
                    type: integer
                    description: The new set ID of the imported snapshot.
                  snaps:
                    type: array
                    items:
                      type: string
    '202':
      $ref: '../components/responses/Accepted.yaml'
    '400':
      $ref: '../components/responses/BadRequest.yaml'
