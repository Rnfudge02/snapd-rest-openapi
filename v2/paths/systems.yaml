# SPDX-License-Identifier: GPL-3.0
# SPDX-FileCopyrightText: Canonical Ltd

get:
  tags:
    - OpenAccess
    - Systems
    - Synchronous
  summary: Get the list of recovery systems
  description: Retrieves a list of all available recovery systems on the device.
  operationId: getSystems
  security: []
  responses:
    '200':
      description: A list of recovery systems.
      content:
        application/json:
          schema:
            type: object
            properties:
              systems:
                type: array
                items:
                  $ref: '../components/schemas/System.yaml'
    '404':
      $ref: '../components/responses/NotFound.yaml'
post:
  tags:
    - AuthenticationRequired
    - Systems
    - Asynchronous # Actions like 'create' and 'install' are async
  summary: Perform an action on the current recovery system or create a new one
  description: Perform an action such as 'reboot', 'install' on the current active recovery system, or 'create' a new recovery system.
  operationId: performSystemAction
  security:
    - PeerAuth: [] # TODO This was originally designated as root auth, investigate
  requestBody:
    required: true
    content:
      application/json:
        schema:
          oneOf:
            - $ref: '../components/schemas/SystemActionCreate.yaml'
            - $ref: '../components/schemas/SystemActionInstall.yaml'
            - $ref: '../components/schemas/SystemActionReboot.yaml'
      multipart/form-data:
        schema:
          type: object
          required:
            - action
            - label
          properties:
            action:
              description: The action to perform. Only 'create' is supported for multipart/form-data.
              type: string
              enum: [create]
            label:
              description: A label for the new recovery system.
              type: string
            test-system:
              description: Whether to create the system as a test system.
              type: boolean
              default: false
            mark-default:
              description: Whether to mark the new system as the default.
              type: boolean
              default: false
            validation-sets:
              description: A comma-separated list of validation set strings.
              type: string
            assertion:
              description: An assertion file content. Can be provided multiple times.
              type: array
              items:
                type: string
            snap:
              description: A snap file. Can be provided multiple times for sideloading.
              type: array
              items:
                type: string
                format: binary
  responses:
    '200':
      description: The action was successfully initiated (for synchronous actions like reboot).
    '202':
      description: The asynchronous action (e.g., create, install) was accepted and is in progress.
      $ref: '../components/responses/Accepted.yaml'
    '400':
      $ref: '../components/responses/BadRequest.yaml'
    '404':
      $ref: '../components/responses/NotFound.yaml'
