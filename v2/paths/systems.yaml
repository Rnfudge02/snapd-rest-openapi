# SPDX-License-Identifier: GPL-3.0
# SPDX-FileCopyrightText: Canonical Ltd

get:
  tags:
    - OpenAccess
    - Systems
    - Synchronous
  summary: Get the list of recovery systems
  description: Retrieves a list of all available recovery systems on the device.
  operationId: getSystems
  security: []
  responses:
    200:
      description: A list of recovery systems.
      content:
        application/json:
          schema:
            type: object
            properties:
              systems:
                type: array
                items:
                  $ref: '../components/schemas/System.yaml'
    404:
      $ref: '../components/responses/NotFound.yaml'
post:
  tags:
    - AuthenticationRequired
    - Systems
    - Synchronous
  summary: Perform an action on a recovery system
  description: Perform an action such as 'reboot', 'create', or 'do' on the current active recovery system.
  operationId: performSystemAction
  security:
    - PeerAuth: []    # TODO This was orginally designated as root auth, investigate
  requestBody:
    required: true
    content:
      application/json:
        schema:
          oneOf:
            - type: object
              required:
                - action
                - mode
              properties:
                action:
                  type: string
                  enum:
                    - create
                    - do
                    - reboot
                mode:
                  type: string
                  enum:
                    - run
                    - recover
            - type: object
              required:
                - action
              properties:
                action:
                  type: string
                  enum:
                  - create
                label:
                  type: string
                test-system:
                  type: boolean
                mark-default:
                  type: boolean
                validation-sets:
                  type: array
                  items:
                    type: string
                offline:
                  type: boolean
            - type: object
              required:
                - action
                - mode
              properties:
                action:
                  type: string
                  enum:
                    - do
                mode:
                  type: string
                  enum:
                    - recover
                    - install
                    - factory-reset
  responses:
    200:
      description: The action was successfully initiated.
      content:
        application/json:
          schema:
            type: object
            properties:
              action:
                type: string
              mode:
                type: string
    404:
      $ref: '../components/responses/NotFound.yaml'
