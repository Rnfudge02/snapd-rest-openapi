# SPDX-License-Identifier: GPL-3.0
# SPDX-FileCopyrightText: Canonical Ltd

get:
  tags:
    - OpenAccess
    - Synchronous
  summary: Get the active model assertion
  description: |-
    Retrieves the active model assertion for the system.
    The model assertion describes a snap-based device.
  externalDocs:
    description: Read more about model assertions on the Ubuntu Core documentation.
    url: https://documentation.ubuntu.com/core/reference/assertions/model/
  operationId: getModelAssertion
  security: []
  responses:
    200:
      description: The raw model assertion text.
      content:
        text/plain:
          schema:
            type: string
            example: |
              type: model
              authority-id: generic
              series:16
              brand-id: generic
              model: generic-classic
              classic: true
              timestamp: 2017-07-27T00:00:00.0Z
              sign-key-sha3-384: d-JcZF9nD9eBw7bwMnH61x-bklnQOhQud1Is6o_cn2wTj8EYDi9musrIT9z2MdAa
              AcLBXAQAAQ[...]
    404:
      $ref: '../components/responses/NotFound.yaml'

post:
  tags:
    - Asynchronous
    - AuthenticationRequired
  summary: Replace the model assertion
  description: |-
    Replaces the current model assertion, potentially triggering a remodel of the system.
  externalDocs:
    description: Read more about offline remodelling on the Ubuntu Core documentation.
    url: https://documentation.ubuntu.com/core/explanation/remodelling/index.html#heading--offline
  operationId: setModelAssertion
  security:
    - PeerAuth: []    # TODO document POST request properly
  requestBody:
    description: The new model assertion, provided as either JSON or multipart/form-data for Offline Remodelling.
    required: true
    content:
      application/json:
        schema:
          type: object
          additionalProperties: true
      multipart/form-data:
        schema:
          type: object
          properties:
            assertion:
              type: string
  responses:
    202:
      $ref: '../components/responses/Accepted.yaml'
    400:
      $ref: '../components/responses/BadRequest.yaml'
